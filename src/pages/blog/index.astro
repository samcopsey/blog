---
import BaseLayout from '../../layouts/BaseLayout.astro';
import BlogFilter from '../../components/BlogFilter.tsx';
import { getCollection } from 'astro:content';
import { getReadingTime } from '../../utils/reading-time';

const allPosts = await getCollection('blog', ({ data }) => !data.draft);
const sortedPosts = allPosts
  .sort((a, b) => new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime())
  .map(post => {
    const minutesRead = getReadingTime(post.body);
    return {
      slug: post.slug,
      title: post.data.title,
      description: post.data.description,
      pubDate: new Date(post.data.pubDate).toISOString(),
      pillar: post.data.pillar,
      format: post.data.format,
      tags: post.data.tags,
      minutesRead,
    };
  });
---

<BaseLayout
  title="Blog"
  description="Practical guides, opinions, and architecture walkthroughs on AI agents, engineering leadership, and sovereign cloud."
>
  <div class="page-container">
    <div class="page-header">
      <h1 class="page-title">Blog</h1>
      <p class="page-subtitle">
        Practical guides, opinions, and architecture walkthroughs on AI agents, engineering
        leadership, and sovereign cloud.
      </p>
    </div>
    <BlogFilter posts={sortedPosts} client:load />
  </div>
</BaseLayout>

<style>
  .page-container {
    padding: 96px 0 64px;
    max-width: 1100px;
    margin: 0 auto;
  }

  .page-header {
    margin-bottom: 48px;
  }

  .page-title {
    font-size: 2.25rem;
    font-weight: 700;
    letter-spacing: -0.02em;
    margin: 0 0 12px;
    color: var(--text-primary);
  }

  .page-subtitle {
    color: var(--text-secondary);
    font-size: 1rem;
    margin: 0;
  }
</style>
